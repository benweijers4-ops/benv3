<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Ben V3.0</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #1a2332;
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header .date {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #2c5282;
        }

        .card h3 {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #3182ce;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: #2c5282;
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-box .number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-box .label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .checkbox-group {
            margin-bottom: 15px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .checkbox-item:hover {
            background: #e9ecef;
        }

        .checkbox-item.checked {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }

        .checkbox-item input[type="checkbox"] {
            width: 24px;
            height: 24px;
            margin-right: 15px;
            cursor: pointer;
        }

        .checkbox-item label {
            flex: 1;
            cursor: pointer;
            font-size: 1.1em;
        }

        .checkbox-item .icon {
            font-size: 1.5em;
            margin-right: 10px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1em;
            transition: border 0.3s;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #2c5282;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: #2c5282;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            background: #2a4365;
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #e53e3e;
        }

        .btn-secondary:hover {
            background: #c53030;
        }

        .btn-success {
            background: #3182ce;
        }

        .btn-success:hover {
            background: #2c5282;
        }

        .nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav button {
            flex: 1;
            min-width: 80px;
            padding: 12px;
            background: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            color: #2c5282;
            transition: all 0.3s;
            font-size: 0.9em;
        }

        .nav button.active {
            background: #2c5282;
            color: white;
        }

        .hidden {
            display: none;
        }

        .motivation-list {
            list-style: none;
        }

        .motivation-list li {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #2c5282;
        }

        .planning-day {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .planning-day strong {
            display: block;
            margin-bottom: 10px;
            color: #2c5282;
        }

        .milestone-box {
            padding: 15px;
            background: #3182ce;
            color: white;
            border-radius: 10px;
            margin-bottom: 10px;
            text-align: center;
        }

        .milestone-box.achieved {
            background: #2c5282;
        }

        .milestone-box .title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .milestone-box .progress {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .tomorrow-preview {
            background: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .tomorrow-preview h3 {
            color: #f57c00;
            margin-bottom: 10px;
        }

        .tomorrow-preview .plan-item {
            padding: 8px 0;
            color: #666;
        }

        .tomorrow-preview .plan-item strong {
            color: #333;
        }

        .fast-reminder {
            background: #ffebee;
            border: 2px solid #ef5350;
            border-radius: 10px;
            padding: 12px;
            margin-top: 10px;
            text-align: center;
            font-weight: 600;
            color: #c62828;
        }

        .progress-bar-container {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: white;
            transition: width 0.3s;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Ben V3.0</h1>
            <div class="date" id="currentDate"></div>
        </div>

        <div class="nav">
            <button class="active" onclick="showView('today')">Today</button>
            <button onclick="showView('stats')">Stats</button>
            <button onclick="showView('trends')">Trends</button>
            <button onclick="showView('planning')">Planning</button>
            <button onclick="showView('settings')">Settings</button>
            <button onclick="showView('personal')">Help?</button>
        </div>

        <!-- TODAY VIEW -->
        <div id="todayView">
            <div class="card">
                <h2>üìã Today's Goals</h2>
                <div class="checkbox-group" id="todayCheckboxes"></div>
                
                <div class="two-column">
                    <div class="input-group">
                        <label>‚öñÔ∏è Weight (lbs)</label>
                        <input type="number" id="todayWeight" step="0.1" placeholder="lbs">
                    </div>
                    <div class="input-group">
                        <label>üìä Body Fat %</label>
                        <input type="number" id="todayBodyFat" step="0.1" placeholder="%">
                    </div>
                </div>

                <button class="btn" onclick="saveToday()">üíæ Save Today</button>
            </div>

            <div class="card">
                <div class="tomorrow-preview">
                    <h3>üåÖ Tomorrow's Plan</h3>
                    <div id="tomorrowPlan"></div>
                </div>
            </div>
        </div>

        <!-- STATS VIEW -->
        <div id="statsView" class="hidden">
            <div class="card">
                <h2>üìä This Week's Progress</h2>
                <div id="weeklyProgress"></div>
            </div>

            <div class="card">
                <h2>üìà Body Metrics</h2>
                <div class="stat-grid">
                    <div class="stat-box">
                        <div class="number" id="currentWeight">--</div>
                        <div class="label">Current Weight (lbs)</div>
                        <div class="label" id="weightGoalText" style="font-size: 0.8em; margin-top: 5px; opacity: 0.8;"></div>
                    </div>
                    <div class="stat-box">
                        <div class="number" id="currentBodyFat">--</div>
                        <div class="label">Body Fat %</div>
                        <div class="label" id="bodyFatGoalText" style="font-size: 0.8em; margin-top: 5px; opacity: 0.8;"></div>
                    </div>
                    <div class="stat-box">
                        <div class="number" id="weightChange">--</div>
                        <div class="label">Weight Change (lbs)</div>
                    </div>
                    <div class="stat-box">
                        <div class="number" id="bodyFatChange">--</div>
                        <div class="label">BF% Change</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üìä All-Time Stats</h2>
                <div class="stat-grid">
                    <div class="stat-box">
                        <div class="number" id="healthyDays">0</div>
                        <div class="label">Healthy Eating Days</div>
                    </div>
                    <div class="stat-box">
                        <div class="number" id="workoutCount">0</div>
                        <div class="label">Workouts</div>
                    </div>
                    <div class="stat-box">
                        <div class="number" id="fastingCount">0</div>
                        <div class="label">Fasts Complete</div>
                    </div>
                    <div class="stat-box">
                        <div class="number" id="guitarCount">0</div>
                        <div class="label">Guitar Sessions</div>
                    </div>
                    <div class="stat-box">
                        <div class="number" id="stepsCount">0</div>
                        <div class="label">Step Goals Hit</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üèÜ Milestones</h2>
                <div id="milestonesList"></div>
            </div>
        </div>

        <!-- TRENDS VIEW -->
        <div id="trendsView" class="hidden">
            <div class="card">
                <h2>üìà Weekly Completion Rate</h2>
                <p style="margin-bottom: 15px; color: #6c757d;">Percentage of daily goals achieved each week</p>
                <canvas id="completionChart" style="max-height: 300px;"></canvas>
            </div>

            <div class="card">
                <h2>‚öñÔ∏è Weight Progress</h2>
                <canvas id="weightChart" style="max-height: 300px;"></canvas>
            </div>

            <div class="card">
                <h2>üìä Body Fat Progress</h2>
                <canvas id="bodyFatChart" style="max-height: 300px;"></canvas>
            </div>
        </div>

        <!-- PERSONAL/RECOVERY VIEW -->
        <div id="personalView" class="hidden">
            <div class="card">
                <h2>üîí Daily Check-In</h2>
                <div class="checkbox-group">
                    <div class="checkbox-item" id="alcoholCheckItem">
                        <span class="icon">üö´</span>
                        <input type="checkbox" id="alcoholFree" onchange="updatePersonalStats()">
                        <label for="alcoholFree">Alcohol Free</label>
                    </div>
                    <div class="checkbox-item" id="nicotineCheckItem">
                        <span class="icon">üö≠</span>
                        <input type="checkbox" id="nicotineFree" onchange="updatePersonalStats()">
                        <label for="nicotineFree">Nicotine Free</label>
                    </div>
                </div>
                <button class="btn" onclick="savePersonal()">üíæ Save</button>
            </div>

            <div class="card">
                <h2>üí∞ Money Saved</h2>
                <div class="stat-grid">
                    <div class="stat-box">
                        <div class="number" id="todayMoneySaved">¬£0</div>
                        <div class="label">Saved Today</div>
                    </div>
                    <div class="stat-box">
                        <div class="number" id="totalMoneySaved">¬£0</div>
                        <div class="label">Total Saved</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üìä Recovery Progress</h2>
                <div class="stat-grid">
                    <div class="stat-box">
                        <div class="number" id="alcoholStreak">0</div>
                        <div class="label">Alcohol-Free Days</div>
                    </div>
                    <div class="stat-box">
                        <div class="number" id="nicotineStreak">0</div>
                        <div class="label">Nicotine-Free Days</div>
                    </div>
                    <div class="stat-box">
                        <div class="number" id="longestAlcoholStreak">0</div>
                        <div class="label">Longest Alcohol Streak</div>
                    </div>
                    <div class="stat-box">
                        <div class="number" id="longestNicotineStreak">0</div>
                        <div class="label">Longest Nicotine Streak</div>
                    </div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <button class="btn btn-secondary" onclick="showMotivation('alcohol')">üç∑ Alcohol Urges</button>
                <button class="btn btn-secondary" onclick="showMotivation('nicotine')">üö¨ Nicotine Urges</button>
            </div>
        </div>

        <!-- PLANNING VIEW -->
        <div id="planningView" class="hidden">
            <div class="card">
                <h2>üìÖ Weekly Planning</h2>
                <p style="margin-bottom: 20px; color: #6c757d;">Set your weekly schedule</p>
                <div id="weeklyPlan"></div>
                <button class="btn" onclick="savePlanning()">üíæ Save Plan</button>
            </div>
        </div>

        <!-- SETTINGS VIEW -->
        <div id="settingsView" class="hidden">
            <div class="card">
                <h2>üéØ Your Goals</h2>
                
                <div class="input-group">
                    <label>Target Weight (lbs)</label>
                    <input type="number" id="goalWeight" step="0.1" placeholder="Leave blank if no goal">
                </div>

                <div class="input-group">
                    <label>Target Body Fat %</label>
                    <input type="number" id="goalBodyFat" step="0.1" placeholder="Leave blank if no goal">
                </div>

                <div class="input-group">
                    <label>Guitar Sessions Per Week</label>
                    <input type="number" id="goalGuitar" value="3" min="0" max="7">
                </div>

                <div class="input-group">
                    <label>Strength Training Per Week</label>
                    <input type="number" id="goalStrength" value="3" min="0" max="7">
                </div>

                <div class="input-group">
                    <label>Total Workouts Per Week</label>
                    <input type="number" id="goalWorkouts" value="4" min="0" max="7">
                </div>

                <div class="input-group">
                    <label>Fasting Days Per Week</label>
                    <input type="number" id="goalFasting" value="2" min="0" max="7">
                </div>

                <div class="input-group">
                    <label>Step Goal Days Per Week</label>
                    <input type="number" id="goalSteps" value="5" min="0" max="7">
                </div>

                <button class="btn" onclick="saveGoals()">üíæ Save Goals</button>
            </div>

            <div class="card">
                <h2>üèãÔ∏è Exercise Library</h2>
                <p style="margin-bottom: 15px; color: #6c757d;">Customize your exercise options</p>
                
                <div style="margin-bottom: 20px;">
                    <strong style="color: #2c5282; display: block; margin-bottom: 10px;">Core/Abs Exercises:</strong>
                    <div class="input-group">
                        <input type="text" id="newExerciseCore" placeholder="e.g., Plank - 60s x 3">
                    </div>
                    <button class="btn btn-success" onclick="addExercise('core')">‚ûï Add Core Exercise</button>
                    <ul class="motivation-list" id="exerciseListCore" style="margin-top: 15px;"></ul>
                </div>

                <div style="margin-bottom: 20px;">
                    <strong style="color: #2c5282; display: block; margin-bottom: 10px;">Chest Exercises:</strong>
                    <div class="input-group">
                        <input type="text" id="newExerciseChest" placeholder="e.g., Dumbbell Press - 15 x 3">
                    </div>
                    <button class="btn btn-success" onclick="addExercise('chest')">‚ûï Add Chest Exercise</button>
                    <ul class="motivation-list" id="exerciseListChest" style="margin-top: 15px;"></ul>
                </div>

                <div style="margin-bottom: 20px;">
                    <strong style="color: #2c5282; display: block; margin-bottom: 10px;">Compound/Full Body:</strong>
                    <div class="input-group">
                        <input type="text" id="newExerciseCompound" placeholder="e.g., Burpees - 15 x 3">
                    </div>
                    <button class="btn btn-success" onclick="addExercise('compound')">‚ûï Add Compound Exercise</button>
                    <ul class="motivation-list" id="exerciseListCompound" style="margin-top: 15px;"></ul>
                </div>
            </div>

            <div class="card">
                <h2>üí™ General Motivational Reasons</h2>
                <p style="margin-bottom: 15px; color: #6c757d;">Core reasons that apply always</p>
                
                <div class="input-group">
                    <input type="text" id="newReason" placeholder="Enter a motivational reason">
                </div>
                <button class="btn btn-success" onclick="addReason()">‚ûï Add Reason</button>

                <ul class="motivation-list" id="reasonsList" style="margin-top: 20px;"></ul>
            </div>

            <div class="card">
                <h2>üç∑ Alcohol Affirmations (Time-Based)</h2>
                <p style="margin-bottom: 15px; color: #6c757d;">Different messages for different stages</p>
                
                <div style="margin-bottom: 20px;">
                    <strong style="color: #2c5282; display: block; margin-bottom: 10px;">Days 1-3 (Hardest Days):</strong>
                    <div class="input-group">
                        <input type="text" id="newAffAlcoholDays13" placeholder="Affirmation for early days">
                    </div>
                    <button class="btn btn-success" onclick="addAffirmation('alcohol', 'days_1_3')">‚ûï Add</button>
                    <ul class="motivation-list" id="affListAlcoholDays13" style="margin-top: 10px;"></ul>
                </div>

                <div style="margin-bottom: 20px;">
                    <strong style="color: #2c5282; display: block; margin-bottom: 10px;">Days 4-7 (First Week):</strong>
                    <div class="input-group">
                        <input type="text" id="newAffAlcoholDays47" placeholder="Affirmation for first week">
                    </div>
                    <button class="btn btn-success" onclick="addAffirmation('alcohol', 'days_4_7')">‚ûï Add</button>
                    <ul class="motivation-list" id="affListAlcoholDays47" style="margin-top: 10px;"></ul>
                </div>

                <div style="margin-bottom: 20px;">
                    <strong style="color: #2c5282; display: block; margin-bottom: 10px;">Week 2 (Building Momentum):</strong>
                    <div class="input-group">
                        <input type="text" id="newAffAlcoholWeek2" placeholder="Affirmation for week 2">
                    </div>
                    <button class="btn btn-success" onclick="addAffirmation('alcohol', 'week_2')">‚ûï Add</button>
                    <ul class="motivation-list" id="affListAlcoholWeek2" style="margin-top: 10px;"></ul>
                </div>

                <div style="margin-bottom: 20px;">
                    <strong style="color: #2c5282; display: block; margin-bottom: 10px;">Weeks 3-4 (One Month):</strong>
                    <div class="input-group">
                        <input type="text" id="newAffAlcoholWeek34" placeholder="Affirmation for approaching 1 month">
                    </div>
                    <button class="btn btn-success" onclick="addAffirmation('alcohol', 'week_3_4')">‚ûï Add</button>
                    <ul class="motivation-list" id="affListAlcoholWeek34" style="margin-top: 10px;"></ul>
                </div>

                <div style="margin-bottom: 20px;">
                    <strong style="color: #5599cc; display: block; margin-bottom: 10px;">Month+ (Long-term):</strong>
                    <div class="input-group">
                        <input type="text" id="newAffAlcoholMonthPlus" placeholder="Affirmation for long-term recovery">
                    </div>
                    <button class="btn btn-success" onclick="addAffirmation('alcohol', 'month_plus')">‚ûï Add</button>
                    <ul class="motivation-list" id="affListAlcoholMonthPlus" style="margin-top: 10px;"></ul>
                </div>
            </div>

            <div class="card">
                <h2>üö¨ Nicotine Affirmations (Time-Based)</h2>
                <p style="margin-bottom: 15px; color: #6c757d;">Different messages for different stages</p>
                
                <div style="margin-bottom: 20px;">
                    <strong style="color: #5fa887; display: block; margin-bottom: 10px;">Days 1-3 (Hardest Days):</strong>
                    <div class="input-group">
                        <input type="text" id="newAffNicotineDays13" placeholder="Affirmation for early days">
                    </div>
                    <button class="btn btn-success" onclick="addAffirmation('nicotine', 'days_1_3')">‚ûï Add</button>
                    <ul class="motivation-list" id="affListNicotineDays13" style="margin-top: 10px;"></ul>
                </div>

                <div style="margin-bottom: 20px;">
                    <strong style="color: #5fa887; display: block; margin-bottom: 10px;">Days 4-7 (First Week):</strong>
                    <div class="input-group">
                        <input type="text" id="newAffNicotineDays47" placeholder="Affirmation for first week">
                    </div>
                    <button class="btn btn-success" onclick="addAffirmation('nicotine', 'days_4_7')">‚ûï Add</button>
                    <ul class="motivation-list" id="affListNicotineDays47" style="margin-top: 10px;"></ul>
                </div>

                <div style="margin-bottom: 20px;">
                    <strong style="color: #5fa887; display: block; margin-bottom: 10px;">Week 2 (Building Momentum):</strong>
                    <div class="input-group">
                        <input type="text" id="newAffNicotineWeek2" placeholder="Affirmation for week 2">
                    </div>
                    <button class="btn btn-success" onclick="addAffirmation('nicotine', 'week_2')">‚ûï Add</button>
                    <ul class="motivation-list" id="affListNicotineWeek2" style="margin-top: 10px;"></ul>
                </div>

                <div style="margin-bottom: 20px;">
                    <strong style="color: #5fa887; display: block; margin-bottom: 10px;">Weeks 3-4 (One Month):</strong>
                    <div class="input-group">
                        <input type="text" id="newAffNicotineWeek34" placeholder="Affirmation for approaching 1 month">
                    </div>
                    <button class="btn btn-success" onclick="addAffirmation('nicotine', 'week_3_4')">‚ûï Add</button>
                    <ul class="motivation-list" id="affListNicotineWeek34" style="margin-top: 10px;"></ul>
                </div>

                <div style="margin-bottom: 20px;">
                    <strong style="color: #5fa887; display: block; margin-bottom: 10px;">Month+ (Long-term):</strong>
                    <div class="input-group">
                        <input type="text" id="newAffNicotineMonthPlus" placeholder="Affirmation for long-term recovery">
                    </div>
                    <button class="btn btn-success" onclick="addAffirmation('nicotine', 'month_plus')">‚ûï Add</button>
                    <ul class="motivation-list" id="affListNicotineMonthPlus" style="margin-top: 10px;"></ul>
                </div>
            </div>

            <div class="card">
                <h2>üí∞ Recovery Costs</h2>
                
                <div class="input-group">
                    <label>Daily Alcohol Cost (¬£)</label>
                    <input type="number" id="alcoholCost" step="0.01" value="10">
                </div>

                <div class="input-group">
                    <label>Daily Nicotine Cost (¬£)</label>
                    <input type="number" id="nicotineCost" step="0.01" value="5">
                </div>

                <button class="btn" onclick="saveSettings()">üíæ Save Settings</button>
            </div>

            <div class="card">
                <button class="btn btn-secondary" onclick="resetData()">üîÑ Reset All Data</button>
            </div>
        </div>
    </div>

    <script>
        let data = {
            settings: {
                alcoholCost: 10,
                nicotineCost: 5
            },
            goals: {
                targetWeight: null,
                targetBodyFat: null,
                guitarPerWeek: 3,
                strengthPerWeek: 3,
                workoutsPerWeek: 4,
                fastingPerWeek: 2,
                stepsPerWeek: 5
            },
            reasons: [
                "I want to be healthier and live longer",
                "I want to save money for things I love",
                "I want to be a better version of myself"
            ],
            affirmations: {
                alcohol: {
                    days_1_3: [
                        "This is the hardest part. Just get through the next hour.",
                        "Your body is healing. The cravings will pass.",
                        "You're stronger than this urge."
                    ],
                    days_4_7: [
                        "You're through the worst of it. Keep going.",
                        "Each day gets easier. You've got momentum.",
                        "You're already seeing benefits. Don't give up now."
                    ],
                    week_2: [
                        "Two weeks is huge! You're building real change.",
                        "Your body thanks you for these 2 weeks of healing.",
                        "The physical cravings are mostly gone. This is mental now."
                    ],
                    week_3_4: [
                        "Almost a month! You're proving you can do this.",
                        "This is becoming your new normal. Keep building.",
                        "One month is a massive achievement. Stay strong."
                    ],
                    month_plus: [
                        "You've come too far to give up now.",
                        "Remember how hard those first days were. Don't go back.",
                        "You're living proof that change is possible."
                    ]
                },
                nicotine: {
                    days_1_3: [
                        "The first 72 hours are the hardest. You can do this.",
                        "Every craving only lasts a few minutes. Ride it out.",
                        "Your lungs are already starting to heal."
                    ],
                    days_4_7: [
                        "The physical addiction is breaking. Stay strong.",
                        "You're getting through the hardest week.",
                        "Think how much money you've already saved."
                    ],
                    week_2: [
                        "Two weeks! Your breathing is improving.",
                        "The habit is breaking. Keep pushing.",
                        "You're past the worst physical symptoms."
                    ],
                    week_3_4: [
                        "Almost a month nicotine-free! This is incredible.",
                        "Your sense of taste and smell are coming back.",
                        "One month shows real commitment. Don't stop now."
                    ],
                    month_plus: [
                        "Look how far you've come. Don't throw it away.",
                        "You're not a smoker anymore. This is who you are now.",
                        "Remember: one puff and you start over."
                    ]
                }
            },
            weeklyPlan: {
                monday: { workout: 'Rest', exercises: [], fasting: false, guitar: false },
                tuesday: { workout: 'Cardio', exercises: [], fasting: true, guitar: true },
                wednesday: { workout: 'Rest', exercises: [], fasting: false, guitar: false },
                thursday: { workout: 'Strength Training', exercises: [], fasting: true, guitar: true },
                friday: { workout: 'Rest', exercises: [], fasting: false, guitar: false },
                saturday: { workout: 'Cardio', exercises: [], fasting: false, guitar: true },
                sunday: { workout: 'Rest', exercises: [], fasting: false, guitar: false }
            },
            exerciseLibrary: {
                core: [
                    'Plank - 45s x 3',
                    'Russian Twists (with dumbbell) - 20 x 3',
                    'Dumbbell Side Bends - 15 each side x 3',
                    'Weighted Sit-ups (dumbbell on chest) - 15 x 3',
                    'Dumbbell Woodchoppers - 12 each side x 3',
                    'Bicycle Crunches - 20 x 3',
                    'Mountain Climbers - 20 x 3',
                    'Leg Raises - 15 x 3'
                ],
                chest: [
                    'Dumbbell Chest Press (lying) - 12 x 3',
                    'Dumbbell Flyes (lying) - 12 x 3',
                    'Dumbbell Pullovers - 12 x 3',
                    'Incline Dumbbell Press - 10 x 3',
                    'Push-ups (feet elevated) - 12 x 3',
                    'Dumbbell Squeeze Press - 12 x 3'
                ],
                compound: [
                    'Dumbbell Thrusters - 12 x 3',
                    'Dumbbell Burpees - 10 x 3',
                    'Dumbbell Squat to Press - 12 x 3',
                    'Dumbbell Renegade Rows - 10 each side x 3',
                    'Dumbbell Swings - 15 x 3',
                    'Goblet Squats - 15 x 3'
                ]
            },
            dailyLogs: {}
        };

        function loadData() {
            const saved = localStorage.getItem('lifestyleTracker');
            if (saved) {
                const loadedData = JSON.parse(saved);
                data = {
                    ...data,
                    ...loadedData,
                    exerciseLibrary: loadedData.exerciseLibrary || data.exerciseLibrary,
                    affirmations: loadedData.affirmations || data.affirmations,
                    weeklyPlan: loadedData.weeklyPlan || data.weeklyPlan,
                    goals: loadedData.goals || data.goals
                };
                
                Object.keys(data.weeklyPlan).forEach(day => {
                    if (!data.weeklyPlan[day].exercises) {
                        data.weeklyPlan[day].exercises = [];
                    }
                });
            }
            updateUI();
        }

        function saveData() {
            localStorage.setItem('lifestyleTracker', JSON.stringify(data));
        }

        function getTodayKey() {
            const today = new Date();
            return today.toISOString().split('T')[0];
        }

        function getTomorrowKey() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            return tomorrow.toISOString().split('T')[0];
        }

        function getDayOfWeek(dateKey = null) {
            const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
            if (dateKey) {
                const date = new Date(dateKey + 'T00:00:00');
                return days[date.getDay()];
            }
            return days[new Date().getDay()];
        }

        function showTomorrowPlan() {
            const tomorrowKey = getTomorrowKey();
            const tomorrowDay = getDayOfWeek(tomorrowKey);
            const plan = data.weeklyPlan[tomorrowDay];
            const tomorrow = new Date(tomorrowKey + 'T00:00:00');
            
            const planDiv = document.getElementById('tomorrowPlan');
            let html = `<div class="plan-item"><strong>${tomorrow.toLocaleDateString('en-GB', { weekday: 'long', month: 'short', day: 'numeric' })}</strong></div>`;
            
            if (plan.workout !== 'Rest') {
                html += `<div class="plan-item">üí™ Workout: ${plan.workout}</div>`;
                if (plan.workout === 'Strength Training' && plan.exercises.length > 0) {
                    html += `<div class="plan-item" style="font-size: 0.9em; padding-left: 20px;">`;
                    plan.exercises.forEach(ex => {
                        html += `‚Ä¢ ${ex}<br>`;
                    });
                    html += `</div>`;
                }
            } else {
                html += `<div class="plan-item">üòå Rest Day</div>`;
            }
            
            if (plan.fasting) {
                html += `<div class="plan-item">‚è±Ô∏è Fasting Day</div>`;
                html += `<div class="fast-reminder">‚ö†Ô∏è Start fasting at 8pm tonight!</div>`;
            }
            
            if (plan.guitar) {
                html += `<div class="plan-item">üé∏ Guitar Practice (20 min)</div>`;
            }
            
            planDiv.innerHTML = html;
        }

        function initTodayCheckboxes() {
            const todayKey = getTodayKey();
            const dayOfWeek = getDayOfWeek();
            const plan = data.weeklyPlan[dayOfWeek];
            const log = data.dailyLogs[todayKey] || {
                ateHealthy: false,
                fasted: false,
                workedOut: false,
                guitarPractice: false,
                stepsTarget: false,
                alcoholFree: false,
                nicotineFree: false,
                weight: null,
                bodyFat: null
            };

            const checkboxes = document.getElementById('todayCheckboxes');
            checkboxes.innerHTML = '';

            const items = [
                { id: 'ateHealthy', label: 'Ate Healthy', icon: 'ü•ó', show: true },
                { id: 'stepsTarget', label: 'Daily Step Target Reached', icon: 'üëü', show: true },
                { id: 'fasted', label: 'Fasted', icon: '‚è±Ô∏è', show: plan.fasting },
                { id: 'workedOut', label: plan.workout === 'Strength Training' && plan.exercises.length > 0 ? 'Workout Complete' : `Worked Out (${plan.workout})`, icon: 'üí™', show: plan.workout !== 'Rest' },
                { id: 'guitarPractice', label: 'Guitar Practice (20min)', icon: 'üé∏', show: plan.guitar }
            ];

            items.forEach(item => {
                if (item.show) {
                    const div = document.createElement('div');
                    div.className = `checkbox-item ${log[item.id] ? 'checked' : ''}`;
                    div.innerHTML = `
                        <span class="icon">${item.icon}</span>
                        <input type="checkbox" id="${item.id}" ${log[item.id] ? 'checked' : ''}>
                        <label for="${item.id}">${item.label}</label>
                    `;
                    div.onclick = (e) => {
                        if (e.target.tagName !== 'INPUT') {
                            const checkbox = div.querySelector('input');
                            checkbox.checked = !checkbox.checked;
                            div.classList.toggle('checked', checkbox.checked);
                        } else {
                            div.classList.toggle('checked', e.target.checked);
                        }
                    };
                    checkboxes.appendChild(div);
                }
            });

            if (plan.workout === 'Strength Training' && plan.exercises.length > 0) {
                const exerciseDiv = document.createElement('div');
                exerciseDiv.style.marginTop = '15px';
                exerciseDiv.style.padding = '15px';
                exerciseDiv.style.background = '#f8f9fa';
                exerciseDiv.style.borderRadius = '10px';
                exerciseDiv.innerHTML = `
                    <strong style="color: #2c5282; margin-bottom: 10px; display: block;">üí™ Today's Exercises:</strong>
                    <ul style="margin: 0; padding-left: 20px;">
                        ${plan.exercises.map(ex => `<li style="margin-bottom: 5px;">${ex}</li>`).join('')}
                    </ul>
                `;
                checkboxes.appendChild(exerciseDiv);
            }

            if (log.weight) {
                document.getElementById('todayWeight').value = log.weight;
            }
            if (log.bodyFat) {
                document.getElementById('todayBodyFat').value = log.bodyFat;
            }

            showTomorrowPlan();
        }

        function initPersonalView() {
            const todayKey = getTodayKey();
            const log = data.dailyLogs[todayKey] || {
                alcoholFree: false,
                nicotineFree: false
            };

            document.getElementById('alcoholFree').checked = log.alcoholFree || false;
            document.getElementById('nicotineFree').checked = log.nicotineFree || false;

            const alcoholItem = document.getElementById('alcoholCheckItem');
            const nicotineItem = document.getElementById('nicotineCheckItem');
            
            if (log.alcoholFree) alcoholItem.classList.add('checked');
            else alcoholItem.classList.remove('checked');
            
            if (log.nicotineFree) nicotineItem.classList.add('checked');
            else nicotineItem.classList.remove('checked');

            alcoholItem.onclick = (e) => {
                if (e.target.tagName !== 'INPUT') {
                    const checkbox = document.getElementById('alcoholFree');
                    checkbox.checked = !checkbox.checked;
                    updatePersonalStats();
                }
            };

            nicotineItem.onclick = (e) => {
                if (e.target.tagName !== 'INPUT') {
                    const checkbox = document.getElementById('nicotineFree');
                    checkbox.checked = !checkbox.checked;
                    updatePersonalStats();
                }
            };

            updatePersonalStats();
        }

        function updatePersonalStats() {
            const alcoholFree = document.getElementById('alcoholFree').checked;
            const nicotineFree = document.getElementById('nicotineFree').checked;
            
            let saved = 0;
            if (alcoholFree) saved += parseFloat(data.settings.alcoholCost);
            if (nicotineFree) saved += parseFloat(data.settings.nicotineCost);

            document.getElementById('todayMoneySaved').textContent = `¬£${saved.toFixed(2)}`;

            const alcoholItem = document.getElementById('alcoholCheckItem');
            const nicotineItem = document.getElementById('nicotineCheckItem');
            
            alcoholItem.classList.toggle('checked', alcoholFree);
            nicotineItem.classList.toggle('checked', nicotineFree);

            updateRecoveryStats();
        }

        function updateRecoveryStats() {
            let totalMoney = 0;
            
            let alcoholStreak = 0;
            let nicotineStreak = 0;
            let longestAlcoholStreak = 0;
            let longestNicotineStreak = 0;
            
            let currentAlcoholStreak = 0;
            let currentNicotineStreak = 0;
            let alcoholStreakActive = true;
            let nicotineStreakActive = true;

            const dates = Object.keys(data.dailyLogs).sort().reverse();

            dates.forEach(date => {
                const log = data.dailyLogs[date];
                
                if (log.alcoholFree) {
                    totalMoney += parseFloat(data.settings.alcoholCost);
                    currentAlcoholStreak++;
                    if (currentAlcoholStreak > longestAlcoholStreak) {
                        longestAlcoholStreak = currentAlcoholStreak;
                    }
                } else {
                    if (alcoholStreakActive) {
                        alcoholStreak = currentAlcoholStreak;
                        alcoholStreakActive = false;
                    }
                    currentAlcoholStreak = 0;
                }
                
                if (log.nicotineFree) {
                    totalMoney += parseFloat(data.settings.nicotineCost);
                    currentNicotineStreak++;
                    if (currentNicotineStreak > longestNicotineStreak) {
                        longestNicotineStreak = currentNicotineStreak;
                    }
                } else {
                    if (nicotineStreakActive) {
                        nicotineStreak = currentNicotineStreak;
                        nicotineStreakActive = false;
                    }
                    currentNicotineStreak = 0;
                }
            });

            if (alcoholStreakActive) alcoholStreak = currentAlcoholStreak;
            if (nicotineStreakActive) nicotineStreak = currentNicotineStreak;

            document.getElementById('totalMoneySaved').textContent = `¬£${totalMoney.toFixed(2)}`;
            document.getElementById('alcoholStreak').textContent = alcoholStreak;
            document.getElementById('nicotineStreak').textContent = nicotineStreak;
            document.getElementById('longestAlcoholStreak').textContent = longestAlcoholStreak;
            document.getElementById('longestNicotineStreak').textContent = longestNicotineStreak;
        }

        function saveToday() {
            const todayKey = getTodayKey();
            const dayOfWeek = getDayOfWeek();
            const plan = data.weeklyPlan[dayOfWeek];
            const log = data.dailyLogs[todayKey] || {};

            log.ateHealthy = document.getElementById('ateHealthy')?.checked || false;
            log.stepsTarget = document.getElementById('stepsTarget')?.checked || false;
            log.fasted = document.getElementById('fasted')?.checked || false;
            log.workedOut = document.getElementById('workedOut')?.checked || false;
            log.guitarPractice = document.getElementById('guitarPractice')?.checked || false;
            log.weight = document.getElementById('todayWeight').value || null;
            log.bodyFat = document.getElementById('todayBodyFat').value || null;
            
            // Save a snapshot of what was planned for this day
            log.plannedWorkout = plan.workout;
            log.plannedGuitar = plan.guitar;
            log.plannedFasting = plan.fasting;

            data.dailyLogs[todayKey] = log;
            saveData();
            alert('‚úÖ Today saved successfully!');
            updateStats();
        }

        function savePersonal() {
            const todayKey = getTodayKey();
            const log = data.dailyLogs[todayKey] || {};

            log.alcoholFree = document.getElementById('alcoholFree').checked;
            log.nicotineFree = document.getElementById('nicotineFree').checked;

            data.dailyLogs[todayKey] = log;
            saveData();
            alert('‚úÖ Personal check-in saved!');
            updateRecoveryStats();
        }

        function updateStats() {
            let healthyDays = 0;
            let workoutCount = 0;
            let fastingCount = 0;
            let guitarCount = 0;
            let stepsCount = 0;
            let weights = [];
            let bodyFats = [];

            // This week's counts
            let thisWeekWorkouts = 0;
            let thisWeekStrength = 0;
            let thisWeekGuitar = 0;
            let thisWeekFasting = 0;
            let thisWeekSteps = 0;

            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay()); // Sunday
            startOfWeek.setHours(0, 0, 0, 0);

            Object.keys(data.dailyLogs).sort().forEach(date => {
                const log = data.dailyLogs[date];
                const logDate = new Date(date + 'T00:00:00');
                
                if (log.ateHealthy) healthyDays++;
                if (log.workedOut) workoutCount++;
                if (log.fasted) fastingCount++;
                if (log.guitarPractice) guitarCount++;
                if (log.stepsTarget) stepsCount++;
                if (log.weight) weights.push(parseFloat(log.weight));
                if (log.bodyFat) bodyFats.push(parseFloat(log.bodyFat));

                // Count this week
                if (logDate >= startOfWeek) {
                    if (log.workedOut) {
                        thisWeekWorkouts++;
                        const dayOfWeek = getDayOfWeek(date);
                        const plan = data.weeklyPlan[dayOfWeek];
                        if (plan && plan.workout === 'Strength Training') {
                            thisWeekStrength++;
                        }
                    }
                    if (log.guitarPractice) thisWeekGuitar++;
                    if (log.fasted) thisWeekFasting++;
                    if (log.stepsTarget) thisWeekSteps++;
                }
            });

            document.getElementById('healthyDays').textContent = healthyDays;
            document.getElementById('workoutCount').textContent = workoutCount;
            document.getElementById('fastingCount').textContent = fastingCount;
            document.getElementById('guitarCount').textContent = guitarCount;
            document.getElementById('stepsCount').textContent = stepsCount;

            // Update weekly progress
            updateWeeklyProgress(thisWeekWorkouts, thisWeekStrength, thisWeekGuitar, thisWeekFasting, thisWeekSteps);

            // Body metrics with goals
            if (weights.length > 0) {
                const currentWeight = weights[weights.length - 1];
                const startWeight = weights[0];
                const change = currentWeight - startWeight;
                
                document.getElementById('currentWeight').textContent = currentWeight.toFixed(1);
                document.getElementById('weightChange').textContent = (change >= 0 ? '+' : '') + change.toFixed(1);

                const goalWeightEl = document.getElementById('weightGoalText');
                if (data.goals.targetWeight) {
                    const remaining = data.goals.targetWeight - currentWeight;
                    goalWeightEl.textContent = `Goal: ${data.goals.targetWeight} lbs (${remaining >= 0 ? '+' : ''}${remaining.toFixed(1)} to go)`;
                } else {
                    goalWeightEl.textContent = '';
                }
            }

            if (bodyFats.length > 0) {
                const currentBF = bodyFats[bodyFats.length - 1];
                const startBF = bodyFats[0];
                const change = currentBF - startBF;
                
                document.getElementById('currentBodyFat').textContent = currentBF.toFixed(1) + '%';
                document.getElementById('bodyFatChange').textContent = (change >= 0 ? '+' : '') + change.toFixed(1) + '%';

                const goalBFEl = document.getElementById('bodyFatGoalText');
                if (data.goals.targetBodyFat) {
                    const remaining = data.goals.targetBodyFat - currentBF;
                    goalBFEl.textContent = `Goal: ${data.goals.targetBodyFat}% (${remaining >= 0 ? '+' : ''}${remaining.toFixed(1)}% to go)`;
                } else {
                    goalBFEl.textContent = '';
                }
            }

            updateMilestones(workoutCount, fastingCount, guitarCount, stepsCount);
        }

        function updateWeeklyProgress(workouts, strength, guitar, fasting, steps) {
            const progressDiv = document.getElementById('weeklyProgress');
            
            // Calculate what was actually planned for days that have passed this week
            // Week starts on Monday, only count days before today
            const today = new Date();
            const dayOfWeek = today.getDay(); // 0 = Sunday, 1 = Monday, etc.
            
            // Get Monday of this week
            const startOfWeek = new Date(today);
            const daysFromMonday = dayOfWeek === 0 ? 6 : dayOfWeek - 1; // If Sunday, go back 6 days to Monday
            startOfWeek.setDate(today.getDate() - daysFromMonday);
            startOfWeek.setHours(0, 0, 0, 0);
            
            let plannedWorkouts = 0;
            let plannedStrength = 0;
            let plannedGuitar = 0;
            let plannedFasting = 0;
            let plannedSteps = 0;
            
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            
            // Calculate how many days have passed since Monday (not including today)
            let daysPassed = 0;
            if (dayOfWeek === 0) {
                // Sunday - count Monday through Saturday
                daysPassed = 6;
            } else if (dayOfWeek === 1) {
                // Monday - no days have passed yet this week
                daysPassed = 0;
            } else {
                // Tuesday onwards - count days from Monday up to (but not including) today
                daysPassed = dayOfWeek - 1;
            }
            
            // Count only days that have passed (NOT including today)
            // Use the saved plan from logs if available, otherwise fall back to current plan
            for (let i = 0; i < daysPassed; i++) {
                const currentDate = new Date(startOfWeek);
                currentDate.setDate(startOfWeek.getDate() + i);
                const dateKey = currentDate.toISOString().split('T')[0];
                const dayName = days[i];
                const log = data.dailyLogs[dateKey];
                
                // Use saved plan from log if available, otherwise use current plan as fallback
                let plan;
                if (log && log.plannedWorkout !== undefined) {
                    // Use the saved snapshot
                    plan = {
                        workout: log.plannedWorkout,
                        guitar: log.plannedGuitar,
                        fasting: log.plannedFasting
                    };
                } else {
                    // Fallback to current plan (for backward compatibility with old logs)
                    plan = data.weeklyPlan[dayName];
                }
                
                // Always count eating healthy and steps for each day
                plannedSteps++; // Each day has step goal
                
                if (plan.workout !== 'Rest') {
                    plannedWorkouts++;
                    if (plan.workout === 'Strength Training') {
                        plannedStrength++;
                    }
                }
                if (plan.guitar) plannedGuitar++;
                if (plan.fasting) plannedFasting++;
            }
            
            const items = [
                { label: 'Total Workouts', current: workouts, goal: plannedWorkouts, icon: 'üí™' },
                { label: 'Strength Training', current: strength, goal: plannedStrength, icon: 'üèãÔ∏è' },
                { label: 'Guitar Sessions', current: guitar, goal: plannedGuitar, icon: 'üé∏' },
                { label: 'Fasting Days', current: fasting, goal: plannedFasting, icon: '‚è±Ô∏è' },
                { label: 'Step Goals', current: steps, goal: plannedSteps, icon: 'üëü' }
            ];

            // Calculate overall completion percentage based on actual planned goals
            let totalPlannedGoals = 0;
            let totalCompleted = 0;
            
            // For each day that has passed (NOT including today), count total checkboxes available vs completed
            for (let i = 0; i < daysPassed; i++) {
                const currentDate = new Date(startOfWeek);
                currentDate.setDate(startOfWeek.getDate() + i);
                const dateKey = currentDate.toISOString().split('T')[0];
                const dayName = days[i];
                const log = data.dailyLogs[dateKey] || {};
                
                // Use saved plan from log if available, otherwise use current plan as fallback
                let plan;
                if (log.plannedWorkout !== undefined) {
                    plan = {
                        workout: log.plannedWorkout,
                        guitar: log.plannedGuitar,
                        fasting: log.plannedFasting
                    };
                } else {
                    plan = data.weeklyPlan[dayName];
                }
                
                // Always have eating healthy and steps
                totalPlannedGoals += 2;
                if (log.ateHealthy) totalCompleted++;
                if (log.stepsTarget) totalCompleted++;
                
                if (plan.workout !== 'Rest') {
                    totalPlannedGoals++;
                    if (log.workedOut) totalCompleted++;
                }
                if (plan.guitar) {
                    totalPlannedGoals++;
                    if (log.guitarPractice) totalCompleted++;
                }
                if (plan.fasting) {
                    totalPlannedGoals++;
                    if (log.fasted) totalCompleted++;
                }
            }
            
            const overallPercent = totalPlannedGoals > 0 ? (totalCompleted / totalPlannedGoals) * 100 : 0;
            const overallStatus = overallPercent >= 100 ? '‚úÖ' : overallPercent > 0 ? 'üîÑ' : '‚è≥';

            let html = '<div class="stat-grid">';
            
            // Add overall completion box first
            html += `
                <div class="stat-box" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <div class="number">${Math.round(overallPercent)}%</div>
                    <div class="label">üìä Overall Completion</div>
                    <div style="width: 100%; height: 8px; background: rgba(255,255,255,0.3); border-radius: 4px; margin-top: 10px; overflow: hidden;">
                        <div style="width: ${overallPercent}%; height: 100%; background: white; transition: width 0.3s;"></div>
                    </div>
                    <div style="margin-top: 5px; font-size: 0.9em;">${overallStatus} ${totalCompleted}/${totalPlannedGoals} goals</div>
                </div>
            `;
            
            items.forEach(item => {
                const percent = item.goal > 0 ? Math.min(100, (item.current / item.goal) * 100) : 0;
                const status = item.current >= item.goal ? '‚úÖ' : item.current > 0 ? 'üîÑ' : '‚è≥';
                
                html += `
                    <div class="stat-box">
                        <div class="number">${item.current}/${item.goal}</div>
                        <div class="label">${item.icon} ${item.label}</div>
                        <div style="width: 100%; height: 8px; background: rgba(255,255,255,0.3); border-radius: 4px; margin-top: 10px; overflow: hidden;">
                            <div style="width: ${percent}%; height: 100%; background: white; transition: width 0.3s;"></div>
                        </div>
                        <div style="margin-top: 5px; font-size: 0.9em;">${status} ${Math.round(percent)}%</div>
                    </div>
                `;
            });
            html += '</div>';
            
            progressDiv.innerHTML = html;
        }

        function updateMilestones(workoutCount, fastingCount, guitarCount, stepsCount) {
            const milestones = [
                { title: '10 Workouts', target: 10, current: workoutCount, type: 'workouts' },
                { title: '25 Workouts', target: 25, current: workoutCount, type: 'workouts' },
                { title: '50 Workouts', target: 50, current: workoutCount, type: 'workouts' },
                { title: '10 Fasts', target: 10, current: fastingCount, type: 'fasts' },
                { title: '25 Fasts', target: 25, current: fastingCount, type: 'fasts' },
                { title: '20 Guitar Sessions', target: 20, current: guitarCount, type: 'guitar' },
                { title: '50 Guitar Sessions', target: 50, current: guitarCount, type: 'guitar' },
                { title: '30 Step Goals', target: 30, current: stepsCount, type: 'steps' },
                { title: '100 Step Goals', target: 100, current: stepsCount, type: 'steps' }
            ];

            const list = document.getElementById('milestonesList');
            list.innerHTML = '';

            milestones.forEach(m => {
                const achieved = m.current >= m.target;
                const progress = Math.min(100, (m.current / m.target) * 100).toFixed(0);

                const div = document.createElement('div');
                div.className = `milestone-box ${achieved ? 'achieved' : ''}`;
                div.innerHTML = `
                    <div class="title">${achieved ? '‚úÖ ' : ''}${m.title}</div>
                    <div class="progress">${m.current}/${m.target} (${progress}%)</div>
                `;
                list.appendChild(div);
            });
        }

        function showMotivation(type) {
            let currentStreak = 0;
            let streakActive = true;
            const dates = Object.keys(data.dailyLogs).sort().reverse();

            dates.forEach(date => {
                const log = data.dailyLogs[date];
                const isFree = type === 'alcohol' ? log.alcoholFree : log.nicotineFree;
                
                if (isFree && streakActive) {
                    currentStreak++;
                } else {
                    streakActive = false;
                }
            });

            let period;
            if (currentStreak <= 3) period = 'days_1_3';
            else if (currentStreak <= 7) period = 'days_4_7';
            else if (currentStreak <= 14) period = 'week_2';
            else if (currentStreak <= 30) period = 'week_3_4';
            else period = 'month_plus';

            const affirmations = data.affirmations[type][period];
            
            const title = type === 'alcohol' ? 'üç∑ ALCOHOL URGES' : 'üö¨ NICOTINE URGES';
            let msg = `${title}\n\n`;
            msg += `You're on DAY ${currentStreak}\n\n`;
            msg += `üí™ AFFIRMATIONS FOR WHERE YOU ARE:\n\n`;
            
            affirmations.forEach((aff, i) => {
                msg += `${i + 1}. ${aff}\n\n`;
            });
            
            msg += `üìñ YOUR PERSONAL REASONS:\n\n`;
            data.reasons.forEach((r, i) => {
                msg += `‚Ä¢ ${r}\n`;
            });
            
            const totalMoney = parseFloat(document.getElementById('totalMoneySaved').textContent.replace('¬£', ''));
            const streakEl = type === 'alcohol' ? 'alcoholStreak' : 'nicotineStreak';
            const streak = parseInt(document.getElementById(streakEl).textContent);
            
            msg += `\nüìä YOUR PROGRESS:\n`;
            msg += `üí∞ Total saved: ¬£${totalMoney.toFixed(2)}\n`;
            msg += `üî• Current streak: ${streak} days\n`;
            msg += `\nYou've got this! üí™`;
            
            alert(msg);
        }

        function initWeeklyPlan() {
            const plan = document.getElementById('weeklyPlan');
            plan.innerHTML = '';

            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            const workoutOptions = ['Rest', 'Cardio', 'Strength Training', 'Yoga', 'HIIT', 'Sports'];

            days.forEach(day => {
                const dayData = data.weeklyPlan[day];
                const div = document.createElement('div');
                div.className = 'planning-day';
                
                let exercisesHTML = '';
                if (dayData.workout === 'Strength Training') {
                    exercisesHTML = `
                        <div style="margin-top: 15px; padding: 15px; background: white; border-radius: 10px;">
                            <strong style="color: #2c5282; margin-bottom: 10px; display: block;">Pick 4-5 Exercises:</strong>
                            <div style="margin-bottom: 10px;">
                                <strong style="font-size: 0.9em; color: #6c757d;">Core/Abs:</strong>
                                <div id="exercises-${day}-core" style="margin-top: 5px;"></div>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <strong style="font-size: 0.9em; color: #6c757d;">Chest:</strong>
                                <div id="exercises-${day}-chest" style="margin-top: 5px;"></div>
                            </div>
                            <div>
                                <strong style="font-size: 0.9em; color: #6c757d;">Compound/Cardio:</strong>
                                <div id="exercises-${day}-compound" style="margin-top: 5px;"></div>
                            </div>
                        </div>
                    `;
                }
                
                div.innerHTML = `
                    <strong>${day.charAt(0).toUpperCase() + day.slice(1)}</strong>
                    <div class="input-group">
                        <label>Workout Type</label>
                        <select id="plan-${day}-workout" onchange="toggleExercises('${day}')">
                            ${workoutOptions.map(opt => `<option value="${opt}" ${dayData.workout === opt ? 'selected' : ''}>${opt}</option>`).join('')}
                        </select>
                    </div>
                    <div id="exercise-picker-${day}">
                        ${exercisesHTML}
                    </div>
                    <div style="display: flex; gap: 20px; margin-top: 10px;">
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" id="plan-${day}-fasting" ${dayData.fasting ? 'checked' : ''}>
                            Fasting Day
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" id="plan-${day}-guitar" ${dayData.guitar ? 'checked' : ''}>
                            Guitar Day
                        </label>
                    </div>
                `;
                plan.appendChild(div);
                
                if (dayData.workout === 'Strength Training') {
                    ['core', 'chest', 'compound'].forEach(category => {
                        const container = document.getElementById(`exercises-${day}-${category}`);
                        data.exerciseLibrary[category].forEach(exercise => {
                            const checked = dayData.exercises.includes(exercise) ? 'checked' : '';
                            const label = document.createElement('label');
                            label.style.display = 'block';
                            label.style.marginBottom = '5px';
                            label.style.fontSize = '0.9em';
                            label.innerHTML = `
                                <input type="checkbox" class="exercise-check-${day}" value="${exercise}" ${checked} style="margin-right: 5px;">
                                ${exercise}
                            `;
                            container.appendChild(label);
                        });
                    });
                }
            });
        }

        function toggleExercises(day) {
            const workout = document.getElementById(`plan-${day}-workout`).value;
            const picker = document.getElementById(`exercise-picker-${day}`);
            
            if (workout === 'Strength Training') {
                let exercisesHTML = `
                    <div style="margin-top: 15px; padding: 15px; background: white; border-radius: 10px;">
                        <strong style="color: #2c5282; margin-bottom: 10px; display: block;">Pick 4-5 Exercises:</strong>
                        <div style="margin-bottom: 10px;">
                            <strong style="font-size: 0.9em; color: #6c757d;">Core/Abs:</strong>
                            <div id="exercises-${day}-core" style="margin-top: 5px;"></div>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong style="font-size: 0.9em; color: #6c757d;">Chest:</strong>
                            <div id="exercises-${day}-chest" style="margin-top: 5px;"></div>
                        </div>
                        <div>
                            <strong style="font-size: 0.9em; color: #6c757d;">Compound/Cardio:</strong>
                            <div id="exercises-${day}-compound" style="margin-top: 5px;"></div>
                        </div>
                    </div>
                `;
                picker.innerHTML = exercisesHTML;
                
                ['core', 'chest', 'compound'].forEach(category => {
                    const container = document.getElementById(`exercises-${day}-${category}`);
                    data.exerciseLibrary[category].forEach(exercise => {
                        const label = document.createElement('label');
                        label.style.display = 'block';
                        label.style.marginBottom = '5px';
                        label.style.fontSize = '0.9em';
                        label.innerHTML = `
                            <input type="checkbox" class="exercise-check-${day}" value="${exercise}" style="margin-right: 5px;">
                            ${exercise}
                        `;
                        container.appendChild(label);
                    });
                });
            } else {
                picker.innerHTML = '';
            }
        }

        function savePlanning() {
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            days.forEach(day => {
                const workout = document.getElementById(`plan-${day}-workout`).value;
                const exercises = [];
                
                if (workout === 'Strength Training') {
                    document.querySelectorAll(`.exercise-check-${day}:checked`).forEach(checkbox => {
                        exercises.push(checkbox.value);
                    });
                }
                
                data.weeklyPlan[day] = {
                    workout: workout,
                    exercises: exercises,
                    fasting: document.getElementById(`plan-${day}-fasting`).checked,
                    guitar: document.getElementById(`plan-${day}-guitar`).checked
                };
            });
            saveData();
            alert('‚úÖ Weekly plan saved!');
        }

        function saveGoals() {
            data.goals.targetWeight = parseFloat(document.getElementById('goalWeight').value) || null;
            data.goals.targetBodyFat = parseFloat(document.getElementById('goalBodyFat').value) || null;
            data.goals.guitarPerWeek = parseInt(document.getElementById('goalGuitar').value);
            data.goals.strengthPerWeek = parseInt(document.getElementById('goalStrength').value);
            data.goals.workoutsPerWeek = parseInt(document.getElementById('goalWorkouts').value);
            data.goals.fastingPerWeek = parseInt(document.getElementById('goalFasting').value);
            data.goals.stepsPerWeek = parseInt(document.getElementById('goalSteps').value);
            saveData();
            alert('‚úÖ Goals saved!');
            updateStats();
        }

        function saveSettings() {
            data.settings.alcoholCost = parseFloat(document.getElementById('alcoholCost').value);
            data.settings.nicotineCost = parseFloat(document.getElementById('nicotineCost').value);
            saveData();
            alert('‚úÖ Settings saved!');
            updateRecoveryStats();
        }

        function addReason() {
            const input = document.getElementById('newReason');
            const reason = input.value.trim();
            if (reason) {
                data.reasons.push(reason);
                saveData();
                input.value = '';
                updateReasonsList();
            }
        }

        function updateReasonsList() {
            const list = document.getElementById('reasonsList');
            list.innerHTML = '';
            data.reasons.forEach((reason, index) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    ${reason}
                    <button onclick="deleteReason(${index})" style="float: right; background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">Delete</button>
                `;
                list.appendChild(li);
            });
        }

        function deleteReason(index) {
            data.reasons.splice(index, 1);
            saveData();
            updateReasonsList();
        }

        function addAffirmation(type, period) {
            const periodKey = period.replace(/_/g, '').replace(/\d/g, '').charAt(0).toUpperCase() + period.replace(/_/g, '').replace(/\d/g, '').slice(1).replace('days', 'Days').replace('week', 'Week').replace('month', 'Month').replace('plus', 'Plus');
            let inputId = `newAff${type.charAt(0).toUpperCase() + type.slice(1)}${periodKey}`;
            
            if (period === 'days_1_3') inputId = `newAff${type.charAt(0).toUpperCase() + type.slice(1)}Days13`;
            else if (period === 'days_4_7') inputId = `newAff${type.charAt(0).toUpperCase() + type.slice(1)}Days47`;
            else if (period === 'week_2') inputId = `newAff${type.charAt(0).toUpperCase() + type.slice(1)}Week2`;
            else if (period === 'week_3_4') inputId = `newAff${type.charAt(0).toUpperCase() + type.slice(1)}Week34`;
            else if (period === 'month_plus') inputId = `newAff${type.charAt(0).toUpperCase() + type.slice(1)}MonthPlus`;
            
            const input = document.getElementById(inputId);
            const affirmation = input.value.trim();
            if (affirmation) {
                data.affirmations[type][period].push(affirmation);
                saveData();
                input.value = '';
                updateAffirmationLists();
            }
        }

        function deleteAffirmation(type, period, index) {
            data.affirmations[type][period].splice(index, 1);
            saveData();
            updateAffirmationLists();
        }

        function updateAffirmationLists() {
            ['alcohol', 'nicotine'].forEach(type => {
                ['days_1_3', 'days_4_7', 'week_2', 'week_3_4', 'month_plus'].forEach(period => {
                    let listId = `affList${type.charAt(0).toUpperCase() + type.slice(1)}`;
                    if (period === 'days_1_3') listId += 'Days13';
                    else if (period === 'days_4_7') listId += 'Days47';
                    else if (period === 'week_2') listId += 'Week2';
                    else if (period === 'week_3_4') listId += 'Week34';
                    else if (period === 'month_plus') listId += 'MonthPlus';
                    
                    const list = document.getElementById(listId);
                    if (list) {
                        list.innerHTML = '';
                        data.affirmations[type][period].forEach((aff, index) => {
                            const li = document.createElement('li');
                            li.innerHTML = `
                                ${aff}
                                <button onclick="deleteAffirmation('${type}', '${period}', ${index})" style="float: right; background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">Delete</button>
                            `;
                            list.appendChild(li);
                        });
                    }
                });
            });
        }

        function addExercise(category) {
            const input = document.getElementById(`newExercise${category.charAt(0).toUpperCase() + category.slice(1)}`);
            const exercise = input.value.trim();
            if (exercise) {
                data.exerciseLibrary[category].push(exercise);
                saveData();
                input.value = '';
                updateExerciseLists();
            }
        }

        function deleteExercise(category, index) {
            data.exerciseLibrary[category].splice(index, 1);
            saveData();
            updateExerciseLists();
        }

        function updateExerciseLists() {
            ['core', 'chest', 'compound'].forEach(category => {
                const list = document.getElementById(`exerciseList${category.charAt(0).toUpperCase() + category.slice(1)}`);
                if (list) {
                    list.innerHTML = '';
                    data.exerciseLibrary[category].forEach((exercise, index) => {
                        const li = document.createElement('li');
                        li.innerHTML = `
                            ${exercise}
                            <button onclick="deleteExercise('${category}', ${index})" style="float: right; background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">Delete</button>
                        `;
                        list.appendChild(li);
                    });
                }
            });
        }

        function resetData() {
            if (confirm('Are you sure you want to reset ALL data? This cannot be undone!')) {
                localStorage.removeItem('lifestyleTracker');
                location.reload();
            }
        }

        let completionChart = null;
        let weightChart = null;
        let bodyFatChart = null;

        function getWeekNumber(dateString) {
            const date = new Date(dateString + 'T00:00:00');
            const firstDayOfYear = new Date(date.getFullYear(), 0, 1);
            const pastDaysOfYear = (date - firstDayOfYear) / 86400000;
            return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);
        }

        function getWeekLabel(dateString) {
            const date = new Date(dateString + 'T00:00:00');
            const weekNum = getWeekNumber(dateString);
            return `Week ${weekNum} (${date.toLocaleDateString('en-GB', { month: 'short', day: 'numeric' })})`;
        }

        function calculateWeeklyCompletions() {
            const weeklyData = {};
            
            Object.keys(data.dailyLogs).sort().forEach(dateKey => {
                const log = data.dailyLogs[dateKey];
                const dayOfWeek = getDayOfWeek(dateKey);
                
                // Use saved plan from log if available, otherwise use current plan as fallback
                let plan;
                if (log.plannedWorkout !== undefined) {
                    plan = {
                        workout: log.plannedWorkout,
                        guitar: log.plannedGuitar,
                        fasting: log.plannedFasting
                    };
                } else {
                    plan = data.weeklyPlan[dayOfWeek];
                }
                
                let totalGoals = 2; // Always have ateHealthy and stepsTarget
                let completedGoals = 0;
                
                if (log.ateHealthy) completedGoals++;
                if (log.stepsTarget) completedGoals++;
                
                if (plan.fasting) {
                    totalGoals++;
                    if (log.fasted) completedGoals++;
                }
                
                if (plan.workout !== 'Rest') {
                    totalGoals++;
                    if (log.workedOut) completedGoals++;
                }
                
                if (plan.guitar) {
                    totalGoals++;
                    if (log.guitarPractice) completedGoals++;
                }
                
                const percentage = totalGoals > 0 ? (completedGoals / totalGoals) * 100 : 0;
                
                const weekLabel = getWeekLabel(dateKey);
                if (!weeklyData[weekLabel]) {
                    weeklyData[weekLabel] = { total: 0, count: 0, dateKey: dateKey };
                }
                weeklyData[weekLabel].total += percentage;
                weeklyData[weekLabel].count++;
            });
            
            const result = Object.keys(weeklyData).map(week => ({
                week: week,
                percentage: weeklyData[week].total / weeklyData[week].count,
                dateKey: weeklyData[week].dateKey
            })).sort((a, b) => a.dateKey.localeCompare(b.dateKey));
            
            return result;
        }

        function initTrends() {
            createCompletionChart();
            createWeightChart();
            createBodyFatChart();
        }

        function createCompletionChart() {
            const ctx = document.getElementById('completionChart');
            const weeklyCompletions = calculateWeeklyCompletions();
            
            if (completionChart) {
                completionChart.destroy();
            }
            
            completionChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: weeklyCompletions.map(w => w.week),
                    datasets: [{
                        label: 'Completion %',
                        data: weeklyCompletions.map(w => w.percentage),
                        borderColor: '#2c5282',
                        backgroundColor: 'rgba(44, 82, 130, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        function createWeightChart() {
            const ctx = document.getElementById('weightChart');
            const weightData = [];
            
            Object.keys(data.dailyLogs).sort().forEach(dateKey => {
                const log = data.dailyLogs[dateKey];
                if (log.weight) {
                    const date = new Date(dateKey + 'T00:00:00');
                    weightData.push({
                        date: date.toLocaleDateString('en-GB', { month: 'short', day: 'numeric' }),
                        weight: parseFloat(log.weight)
                    });
                }
            });
            
            if (weightChart) {
                weightChart.destroy();
            }
            
            weightChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: weightData.map(d => d.date),
                    datasets: [{
                        label: 'Weight (lbs)',
                        data: weightData.map(d => d.weight),
                        borderColor: '#3182ce',
                        backgroundColor: 'rgba(49, 130, 206, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });
        }

        function createBodyFatChart() {
            const ctx = document.getElementById('bodyFatChart');
            const bodyFatData = [];
            
            Object.keys(data.dailyLogs).sort().forEach(dateKey => {
                const log = data.dailyLogs[dateKey];
                if (log.bodyFat) {
                    const date = new Date(dateKey + 'T00:00:00');
                    bodyFatData.push({
                        date: date.toLocaleDateString('en-GB', { month: 'short', day: 'numeric' }),
                        bodyFat: parseFloat(log.bodyFat)
                    });
                }
            });
            
            if (bodyFatChart) {
                bodyFatChart.destroy();
            }
            
            bodyFatChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: bodyFatData.map(d => d.date),
                    datasets: [{
                        label: 'Body Fat %',
                        data: bodyFatData.map(d => d.bodyFat),
                        borderColor: '#38a169',
                        backgroundColor: 'rgba(56, 161, 105, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        function showView(view) {
            document.getElementById('todayView').classList.add('hidden');
            document.getElementById('statsView').classList.add('hidden');
            document.getElementById('trendsView').classList.add('hidden');
            document.getElementById('personalView').classList.add('hidden');
            document.getElementById('planningView').classList.add('hidden');
            document.getElementById('settingsView').classList.add('hidden');

            document.getElementById(`${view}View`).classList.remove('hidden');

            document.querySelectorAll('.nav button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            if (view === 'today') initTodayCheckboxes();
            if (view === 'stats') updateStats();
            if (view === 'trends') initTrends();
            if (view === 'personal') initPersonalView();
            if (view === 'planning') initWeeklyPlan();
            if (view === 'settings') {
                document.getElementById('alcoholCost').value = data.settings.alcoholCost;
                document.getElementById('nicotineCost').value = data.settings.nicotineCost;
                document.getElementById('goalWeight').value = data.goals.targetWeight || '';
                document.getElementById('goalBodyFat').value = data.goals.targetBodyFat || '';
                document.getElementById('goalGuitar').value = data.goals.guitarPerWeek;
                document.getElementById('goalStrength').value = data.goals.strengthPerWeek;
                document.getElementById('goalWorkouts').value = data.goals.workoutsPerWeek;
                document.getElementById('goalFasting').value = data.goals.fastingPerWeek;
                document.getElementById('goalSteps').value = data.goals.stepsPerWeek;
                updateReasonsList();
                updateExerciseLists();
                updateAffirmationLists();
            }
        }

        function updateUI() {
            const today = new Date();
            document.getElementById('currentDate').textContent = today.toLocaleDateString('en-GB', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            initTodayCheckboxes();
            updateStats();
        }

        loadData();
    </script>
</body>
</html>
